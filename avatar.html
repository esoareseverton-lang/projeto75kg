<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Projeto 75kg ‚Äî Prot√≥tipo Atualizado</title>
<style>
  body{font-family:Inter,Arial,sans-serif;background:#f5f7fa;margin:0;padding:20px;display:flex;gap:20px;flex-direction:column;align-items:center}
  .wrap{max-width:1100px;width:100%;display:grid;grid-template-columns:360px 1fr;gap:20px}
  .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h2{margin:0 0 12px 0}
  label{display:block;margin-top:8px;font-size:14px}
  input[type=text], input[type=number], input[type=password], select{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd;margin-top:6px}
  button{margin-top:10px;padding:10px 12px;border-radius:8px;border:0;background:#2563eb;color:#fff;cursor:pointer}
  .avatar-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .avatar-stage{position:relative;width:100%;max-width:480px;height:360px;border-radius:10px;overflow:hidden;background:#eef2ff;display:flex;align-items:center;justify-content:center}
  .avatar-stage img{position:absolute;width:100%;height:100%;object-fit:contain;transition:opacity .5s ease, transform .5s ease}
  .progress-bar{width:100%;height:18px;background:#eee;border-radius:9px;overflow:hidden;margin-top:8px}
  .progress-bar > div{height:100%;background:linear-gradient(90deg,#3b82f6,#06b6d4);width:0%;transition:width .6s ease}
  .msg{font-size:15px;color:#333;margin-top:8px}
  .small{font-size:13px;color:#666}
  .history{max-height:180px;overflow:auto;margin-top:8px}
  .row{display:flex;gap:8px}
  .note{font-size:13px;color:#555;margin-top:6px}
</style>
</head>
<body>
  <h1>Projeto 75kg ‚Äî Prot√≥tipo Atualizado</h1>
  <div class="wrap">
    <!-- esquerda: autentica√ß√£o + formularios -->
    <div>
      <div class="card" id="authCard">
        <h2>Conta</h2>
        <div id="authForms">
          <div id="signupForm">
            <label>Email</label>
            <input type="text" id="suEmail" placeholder="seu@email.com" />
            <label>Senha</label>
            <input type="password" id="suPass" placeholder="senha"/>
            <button id="btnSignup">Criar conta</button>
            <p class="small">Ou <a href="#" id="showLogin">Fazer login</a></p>
          </div>
          <div id="loginForm" style="display:none">
            <label>Email</label>
            <input type="text" id="liEmail" />
            <label>Senha</label>
            <input type="password" id="liPass" />
            <button id="btnLogin">Entrar</button>
            <p class="small">Ou <a href="#" id="showSignup">Criar conta</a></p>
          </div>
        </div>
        <div id="logged" style="display:none">
          <p class="small">Logado como <strong id="userEmail"></strong></p>
          <button id="btnLogout" style="background:#ef4444">Sair</button>
        </div>
      </div>

      <div class="card" id="measuresCard" style="margin-top:14px; display:none">
        <h2>Medidas & Meta</h2>
        <label>Peso atual (kg)</label>
        <input type="number" id="pesoAtual" step="0.1" />
        <label>Peso meta (kg)</label>
        <input type="number" id="pesoMeta" step="0.1" />
        <label>Cintura (cm)</label>
        <input type="number" id="cintura" />
        <label>Peito (cm)</label>
        <input type="number" id="peito" />
        <label>Bra√ßo (cm)</label>
        <input type="number" id="braco" />
        <label>Perna (cm)</label>
        <input type="number" id="perna" />
        <label>Tipo corporal desejado</label>
        <select id="bodyType">
          <option value="normal">Normal</option>
          <option value="seco">Seco (magro)</option>
          <option value="musculoso">Musculoso</option>
        </select>
        <div class="row">
          <button id="btnSave">Salvar medida</button>
          <button id="btnUsePhaseImages">Usar imagens padr√£o</button>
        </div>
        <p class="note">Observa√ß√£o: para prot√≥tipo, os dados ficam no navegador (localStorage). Para multiusu√°rios e seguran√ßa, usar Firebase.</p>
        <div class="history card" id="historyBox" style="margin-top:10px"></div>
      </div>
    </div>

    <!-- direita: avatar, progresso -->
    <div>
      <div class="card avatar-wrap">
        <h2>Progresso e Avatar</h2>
        <div class="avatar-stage" id="avatarStage">
          <!-- three images crossfade; ensure files phase1.png phase2.png phase3.png exist in same folder -->
          <img id="imgPhase1" src="phase1.png" style="opacity:1"/>
          <img id="imgPhase2" src="phase2.png" style="opacity:0"/>
          <img id="imgPhase3" src="phase3.png" style="opacity:0"/>
        </div>

        <div style="width:100%;margin-top:8px">
          <div class="progress-bar"><div id="progressFill"></div></div>
          <div class="row" style="margin-top:8px;align-items:center">
            <div style="flex:1"><strong id="percentText">0%</strong></div>
            <div><button id="btnPreview">Atualizar Avatar</button></div>
          </div>
          <div class="msg" id="motivation">Bem-vindo! Insira suas medidas para come√ßar.</div>
        </div>
      </div>
    </div>
  </div>

<script>
const messages = {
  low: [
    "Bora come√ßar! Um passo de cada vez üí™",
    "A jornada √© longa, mas voc√™ j√° deu o primeiro passo!",
    "Pequenas vit√≥rias hoje, grandes resultados amanh√£."
  ],
  mid: [
    "T√° indo muito bem ‚Äî continue assim! üî•",
    "Metade do caminho andado! N√£o pare agora!",
    "Voc√™ merece essa evolu√ß√£o. Continue!"
  ],
  high: [
    "Quase l√°! Manda ver na √∫ltima etapa! üèÅ",
    "Meta √† vista ‚Äî foco no sprint final!",
    "Uau! Quase perfeito, n√£o desista agora!"
  ]
};

function saveUsers(users){ localStorage.setItem('p75_users', JSON.stringify(users)); }
function loadUsers(){ return JSON.parse(localStorage.getItem('p75_users')||'{}'); }

function setCurrentUser(email){
  localStorage.setItem('p75_current', email);
  renderAuthState();
}
function getCurrentUser(){ return localStorage.getItem('p75_current'); }

function saveUserData(email, data){
  const db = JSON.parse(localStorage.getItem('p75_data')||'{}');
  db[email] = db[email] || {records:[]};
  if(data.record) db[email].records.unshift(data.record);
  if(data.meta) db[email].meta = Object.assign(db[email].meta||{}, data.meta);
  if(data.images) db[email].images = Object.assign(db[email].images||{}, data.images);
  if(data.bodyType) db[email].bodyType = data.bodyType;
  localStorage.setItem('p75_data', JSON.stringify(db));
}
function getUserData(email){
  const db = JSON.parse(localStorage.getItem('p75_data')||'{}');
  return db[email] || {records:[], meta:{}, images:{}};
}

/* Auth UI */
const signupForm = document.getElementById('signupForm');
const loginForm = document.getElementById('loginForm');
document.getElementById('showLogin').onclick = e=>{ e.preventDefault(); signupForm.style.display='none'; loginForm.style.display='block'; }
document.getElementById('showSignup').onclick = e=>{ e.preventDefault(); signupForm.style.display='block'; loginForm.style.display='none'; }

document.getElementById('btnSignup').onclick = ()=>{
  const email = document.getElementById('suEmail').value.trim();
  const pass = document.getElementById('suPass').value;
  if(!email||!pass){ alert('Preencha email e senha'); return; }
  const users = loadUsers();
  if(users[email]){ alert('Conta j√° existe, fa√ßa login'); return; }
  users[email] = {password: btoa(pass)};
  saveUsers(users);
  setCurrentUser(email);
  saveUserData(email, {images:{p1:'phase1.png', p2:'phase2.png', p3:'phase3.png'}, bodyType:'normal'});
  alert('Conta criada e logado!');
}

document.getElementById('btnLogin').onclick = ()=>{
  const email = document.getElementById('liEmail').value.trim();
  const pass = document.getElementById('liPass').value;
  const users = loadUsers();
  if(!users[email] || users[email].password !== btoa(pass)) { alert('Email ou senha inv√°lidos'); return; }
  setCurrentUser(email);
  alert('Logado!');
}

document.getElementById('btnLogout').onclick = ()=>{
  localStorage.removeItem('p75_current');
  renderAuthState();
}

/* Measures UI */
function renderAuthState(){
  const cur = getCurrentUser();
  document.getElementById('authForms').style.display = cur ? 'none':'block';
  document.getElementById('logged').style.display = cur ? 'block':'none';
  document.getElementById('measuresCard').style.display = cur ? 'block':'none';
  if(cur) document.getElementById('userEmail').textContent = cur;
  renderHistory();
  updateProgressVisual();
}

document.getElementById('btnSave').onclick = ()=>{
  const cur = getCurrentUser(); if(!cur){ alert('Fa√ßa login'); return; }
  const peso = parseFloat(document.getElementById('pesoAtual').value);
  const meta = parseFloat(document.getElementById('pesoMeta').value);
  const cintura = parseFloat(document.getElementById('cintura').value||0);
  const peito = parseFloat(document.getElementById('peito').value||0);
  const braco = parseFloat(document.getElementById('braco').value||0);
  const perna = parseFloat(document.getElementById('perna').value||0);
  const bodyType = document.getElementById('bodyType').value;
  if(isNaN(peso) || isNaN(meta)){ alert('Informe peso atual e meta'); return; }
  const record = {date:new Date().toISOString(), peso, cintura, peito, braco, perna, bodyType};
  saveUserData(cur, {record, meta:{pesoMeta:meta}, bodyType});
  renderHistory();
  updateProgressVisual();
  document.getElementById('motivation').textContent = pickMessage(getProgressPercent());
  alert('Medida salva!');
}

document.getElementById('btnUsePhaseImages').onclick = ()=>{
  alert('Usando imagens padr√£o (phase1.png / phase2.png / phase3.png). Substitua por imagens pr√≥prias no reposit√≥rio se quiser.');
}

/* History */
function renderHistory(){
  const cur = getCurrentUser(); if(!cur) return;
  const data = getUserData(cur);
  const box = document.getElementById('historyBox');
  if(!data.records.length){ box.innerHTML = '<p class="small">Sem medi√ß√µes ainda.</p>'; return; }
  box.innerHTML = data.records.map(r=>`<div style="border-bottom:1px solid #eee;padding:6px 0"><strong>${new Date(r.date).toLocaleDateString()}</strong> ‚Äî ${r.peso} kg ‚Äî Cintura: ${r.cintura || '-'} cm ‚Äî Bra√ßo: ${r.braco || '-'} cm ‚Äî Perna: ${r.perna || '-'} cm</div>`).join('');
}

/* Progress & Avatar logic */
/* We'll compute a weighted progress:
   - weight: 50%
   - waist: 15%
   - chest: 10%
   - arm: 12.5%
   - leg: 12.5%
   The formula compares latest measurement to initial (first record) towards goal (for weight goal) or proportional changes for circumferences.
*/
function getInitialMeasurements(records){
  if(!records.length) return null;
  return records[records.length-1]; // last item = oldest due to unshift
}

function getProgressPercent(){
  const cur = getCurrentUser(); if(!cur) return 0;
  const data = getUserData(cur);
  if(!data.records.length || !data.meta || !data.meta.pesoMeta) return 0;
  const latest = data.records[0];
  const initial = getInitialMeasurements(data.records) || latest;
  const goalWeight = data.meta.pesoMeta;

  // weight progress (50% weight)
  let weightProgress = 0;
  if(initial.peso === latest.peso) weightProgress = 0;
  if(goalWeight < initial.peso){ // losing weight
    weightProgress = ((initial.peso - latest.peso) / (initial.peso - goalWeight));
  } else { // gaining weight
    weightProgress = ((latest.peso - initial.peso) / (goalWeight - initial.peso));
  }
  weightProgress = clamp01(weightProgress);

  // for circumferences (we assume for cintura and peito goal is reduction for "seco" or increase for "musculoso")
  // if user chose 'seco' we consider goals as reductions proportional to initial -> a target is inferred (simple heuristic):
  const bt = data.bodyType || latest.bodyType || 'normal';
  // heuristics: target cintura reduced by 10% for seco, +0% for normal, -5% for musculoso (less reduction)
  const cinturaTarget = bt === 'seco' ? initial.cintura * 0.9 : (bt === 'musculoso' ? initial.cintura * 0.95 : initial.cintura * 0.95);
  const peitoTarget = bt === 'musculoso' ? initial.peito * 1.08 : initial.peito * 0.98;
  const bracoTarget = bt === 'musculoso' ? initial.braco * 1.08 : initial.braco * 0.95;
  const pernaTarget = bt === 'musculoso' ? initial.perna * 1.06 : initial.perna * 0.97;

  function singleProgress(current, initialVal, target, reduceIfHigher=true){
    if(!initialVal || !current) return 0;
    if(reduceIfHigher){
      // progress toward reducing initial -> target (target < initial)
      const denom = initialVal - target;
      if(denom === 0) return 0;
      return clamp01((initialVal - current) / denom);
    } else {
      const denom = target - initialVal;
      if(denom === 0) return 0;
      return clamp01((current - initialVal) / denom);
    }
  }

  const cinturaProg = singleProgress(latest.cintura, initial.cintura, cinturaTarget, true);
  const peitoProg = bt === 'musculoso' ? singleProgress(latest.peito, initial.peito, peitoTarget, false) : singleProgress(latest.peito, initial.peito, peitoTarget, true);
  const bracoProg = bt === 'musculoso' ? singleProgress(latest.braco, initial.braco, bracoTarget, false) : singleProgress(latest.braco, initial.braco, bracoTarget, true);
  const pernaProg = bt === 'musculoso' ? singleProgress(latest.perna, initial.perna, pernaTarget, false) : singleProgress(latest.perna, initial.perna, pernaTarget, true);

  // weights distribution
  const wWeight = 0.5, wCint = 0.15, wPeito = 0.10, wBraco = 0.125, wPerna = 0.125;

  const combined = (weightProgress * wWeight) + (cinturaProg * wCint) + (peitoProg * wPeito) + (bracoProg * wBraco) + (pernaProg * wPerna);
  const percent = Math.round(clamp01(combined) * 100);
  return percent;
}

function clamp01(v){ return Math.max(0, Math.min(1, isFinite(v)?v:0)); }

function pickMessage(percent){
  if(percent < 35) return messages.low[Math.floor(Math.random()*messages.low.length)];
  if(percent < 75) return messages.mid[Math.floor(Math.random()*messages.mid.length)];
  return messages.high[Math.floor(Math.random()*messages.high.length)];
}

function updateProgressVisual(){
  const pct = getProgressPercent();
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('percentText').textContent = pct + '%';
  const p1 = document.getElementById('imgPhase1');
  const p2 = document.getElementById('imgPhase2');
  const p3 = document.getElementById('imgPhase3');

  if(pct <= 33){
    p1.style.opacity = 1; p2.style.opacity = 0; p3.style.opacity = 0;
  } else if(pct <= 66){
    const t = (pct - 33)/(33);
    p1.style.opacity = 1 - t; p2.style.opacity = t; p3.style.opacity = 0;
  } else {
    const t = (pct - 66)/(34);
    p1.style.opacity = 0; p2.style.opacity = 1 - t; p3.style.opacity = t;
  }
  const data = getUserData(getCurrentUser()||'');
  document.getElementById('motivation').textContent = pickMessage(pct) + (data.bodyType ? ' ‚Ä¢ Tipo: ' + data.bodyType : '');
}

/* Buttons and init */
document.getElementById('btnPreview').onclick = ()=>{
  if(!getCurrentUser()){ alert('Fa√ßa login'); return; }
  updateProgressVisual();
  alert('Avatar atualizado conforme suas medidas.');
}

renderAuthState();
</script>
</body>
</html>
