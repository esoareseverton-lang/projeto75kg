<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Projeto 75kg ‚Äî Evolu√ß√£o</title>
<style>
  :root{--bg:#f5f7fa;--card:#fff;--accent:#2563eb}
  body{font-family:Inter,Arial,sans-serif;background:var(--bg);margin:0;padding:18px;display:flex;flex-direction:column;align-items:center}
  .wrap{max-width:1100px;width:100%;display:grid;grid-template-columns:360px 1fr;gap:18px}
  .card{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.06)}
  h1{margin:0 0 12px 0}
  label{display:block;margin-top:10px;font-size:14px;color:#333}
  input, select{width:100%;padding:9px;border-radius:8px;border:1px solid #ddd;margin-top:6px;font-size:14px}
  button{margin-top:12px;padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer}
  .row{display:flex;gap:8px;align-items:center}
  .avatar-stage{position:relative;width:100%;max-width:520px;height:420px;border-radius:8px;overflow:hidden;background:#fff;border:1px solid #e6e6e6;display:flex;align-items:center;justify-content:center}
  .phase{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;transition:opacity .45s ease,transform .4s ease}
  .progress-bar{width:100%;height:18px;background:#eee;border-radius:999px;overflow:hidden;margin-top:12px}
  .progress-bar > div{height:100%;background:linear-gradient(90deg,#000,#444);width:0%;transition:width .6s ease}
  .msg{margin-top:10px;color:#333}
  .small{font-size:13px;color:#666}
  .history{max-height:200px;overflow:auto;margin-top:8px;padding:8px;border-radius:6px;background:#fafafa;border:1px solid #f0f0f0}
  .userBox{display:flex;justify-content:space-between;align-items:center}
  .toggle-sex{display:flex;gap:10px;margin-top:6px}
  .note{font-size:13px;color:#666;margin-top:8px}
  /* responsive */
  @media (max-width:900px){
    .wrap{grid-template-columns:1fr; padding-bottom:40px}
    .avatar-stage{max-width:100%}
  }
</style>
</head>
<body>
<h1>Projeto 75kg ‚Äî Acompanhe sua evolu√ß√£o</h1>

<div class="wrap">
  <!-- LEFT: auth + form -->
  <div>
    <div class="card" id="authCard">
      <h2>Conta</h2>
      <div id="authForms">
        <label>Email</label><input id="suEmail" placeholder="seu@email.com"/>
        <label>Senha</label><input id="suPass" type="password" placeholder="senha"/>
        <div class="row">
          <button id="btnSignup">Criar conta</button>
          <button id="showLogin" style="background:#06b6d4">Fazer login</button>
        </div>

        <div id="loginPanel" style="display:none;margin-top:12px">
          <label>Email</label><input id="liEmail"/>
          <label>Senha</label><input id="liPass" type="password"/>
          <div class="row">
            <button id="btnLogin">Entrar</button>
            <button id="showSignup" style="background:#06b6d4">Voltar</button>
          </div>
        </div>
      </div>

      <div id="logged" style="display:none;margin-top:10px">
        <div class="userBox">
          <div><strong id="userEmail">usuario@exemplo</strong></div>
          <div><button id="btnLogout" style="background:#ef4444">Sair</button></div>
        </div>
      </div>
    </div>

    <div class="card" id="measuresCard" style="margin-top:14px;display:none">
      <h2>Medidas & Meta</h2>

      <label>Sexo</label>
      <div class="toggle-sex">
        <label><input type="radio" name="sex" value="male" checked/> Masculino</label>
        <label><input type="radio" name="sex" value="female"/> Feminino</label>
      </div>

      <label>Peso atual (kg)</label><input id="pesoAtual" type="number" step="0.1"/>
      <label>Peso meta (kg)</label><input id="pesoMeta" type="number" step="0.1"/>
      <label>Cintura (cm)</label><input id="cintura" type="number"/>
      <label>Peito (cm)</label><input id="peito" type="number"/>
      <label>Bra√ßo (cm)</label><input id="braco" type="number"/>
      <label>Perna (cm)</label><input id="perna" type="number"/>

      <label>Tipo corporal desejado</label>
      <select id="bodyType">
        <option value="normal">Normal</option>
        <option value="seco">Seco (magro)</option>
        <option value="musculoso">Musculoso</option>
      </select>

      <div class="row">
        <button id="btnSave">Salvar medida</button>
        <button id="btnClear" style="background:#ef4444">Limpar hist√≥rico</button>
      </div>

      <div class="note">Dados salvos no seu navegador (localStorage). Para produ√ß√£o multiusu√°rio, migraremos para Firebase com autentica√ß√£o e storage seguro.</div>

      <div class="history" id="historyBox" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- RIGHT: avatar & progresso -->
  <div>
    <div class="card">
      <h2>Progresso e Avatar</h2>

      <div class="avatar-stage" id="avatarStage">
        <!-- MALE phases (SVG line-art PB) -->
        <div class="phase" id="male_p1" style="opacity:1">
          <!-- Phase 1: in√≠cio (mais volume) -->
          <svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" style="width:78%;height:auto">
            <g fill="none" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="200" cy="80" r="36"/>
              <path d="M126 140 C150 180 250 180 274 140"/>
              <ellipse cx="200" cy="330" rx="120" ry="140"/>
              <path d="M100 260 C100 300 120 340 120 380" />
              <path d="M300 260 C300 300 280 340 280 380" />
              <path d="M140 460 C150 500 170 520 200 520 C230 520 250 500 260 460" />
            </g>
          </svg>
        </div>

        <div class="phase" id="male_p2" style="opacity:0">
          <!-- Phase 2: intermedi√°rio -->
          <svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg" style="width:78%;height:auto">
            <g fill="none" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="200" cy="72" r="34"/>
              <path d="M140 120 C160 150 240 150 260 120"/>
              <ellipse cx="200" cy="320" rx="88" ry="110"/>
              <path d="M120 260 C125 300 140 340 140 380" />
              <path d="M280 260 C275 300 260 340 260 380" />
              <path d="M140 430 C150 470 170 490 200 490 C230 490 250 470 260 430" />
            </g>
          </svg>
        </div>

        <div class="phase" id="male_p3" style="opacity:0">
          <!-- Phase 3: objetivo (definido) -->
          <svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg" style="width:78%;height:auto">
            <g fill="none" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="200" cy="64" r="30"/>
              <path d="M130 110 C155 95 245 95 270 110"/>
              <path d="M120 160 C150 140 250 140 280 160"/>
              <path d="M120 200 C150 180 250 180 280 200"/>
              <path d="M140 260 C150 240 170 230 200 230 C230 230 250 240 260 260"/>
              <path d="M100 240 C120 220 120 300 100 340" />
              <path d="M300 240 C280 220 280 300 300 340" />
              <path d="M140 420 C150 470 170 490 200 490 C230 490 250 470 260 420"/>
            </g>
          </svg>
        </div>

        <!-- FEMALE phases (same style, mirrored or tailored) -->
        <div class="phase" id="female_p1" style="opacity:0;transform:scaleX(-1)">
          <svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg" style="width:78%;height:auto">
            <g fill="none" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="200" cy="80" r="34"/>
              <path d="M140 130 C160 170 240 170 260 130"/>
              <ellipse cx="200" cy="340" rx="110" ry="140"/>
              <path d="M120 260 C125 300 140 340 140 380" />
              <path d="M280 260 C275 300 260 340 260 380" />
              <path d="M140 460 C150 500 170 520 200 520 C230 520 250 500 260 460" />
            </g>
          </svg>
        </div>

        <div class="phase" id="female_p2" style="opacity:0;transform:scaleX(-1)">
          <svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg" style="width:78%;height:auto">
            <g fill="none" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="200" cy="72" r="32"/>
              <path d="M150 120 C165 150 235 150 250 120"/>
              <ellipse cx="200" cy="320" rx="86" ry="110"/>
              <path d="M120 260 C125 300 140 340 140 380" />
              <path d="M280 260 C275 300 260 340 260 380" />
            </g>
          </svg>
        </div>

        <div class="phase" id="female_p3" style="opacity:0;transform:scaleX(-1)">
          <svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg" style="width:78%;height:auto">
            <g fill="none" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="200" cy="64" r="28"/>
              <path d="M140 110 C160 95 240 95 260 110"/>
              <path d="M140 180 C160 160 240 160 260 180"/>
              <path d="M140 220 C155 200 245 200 260 220"/>
              <path d="M140 300 C150 340 170 360 200 360 C230 360 250 340 260 300"/>
            </g>
          </svg>
        </div>

      </div>

      <div style="width:100%;margin-top:12px">
        <div class="progress-bar"><div id="progressFill"></div></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div><strong id="percentText">0%</strong></div>
          <div><button id="btnPreview">Atualizar Avatar</button></div>
        </div>
        <div class="msg" id="motivation">Bem-vindo! Crie conta e registre sua primeira medida.</div>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- Storage & Auth ---------- */
function loadUsers(){ return JSON.parse(localStorage.getItem('p75_users')||'{}'); }
function saveUsers(u){ localStorage.setItem('p75_users', JSON.stringify(u)); }
function loadData(){ return JSON.parse(localStorage.getItem('p75_data')||'{}'); }
function saveData(d){ localStorage.setItem('p75_data', JSON.stringify(d)); }
function getCurrent(){ return localStorage.getItem('p75_current'); }
function setCurrent(email){ localStorage.setItem('p75_current', email); renderAuthState(); }

/* UI toggles */
document.getElementById('showLogin').onclick = ()=>{ document.getElementById('loginPanel').style.display='block'; }
document.getElementById('showSignup').onclick = ()=>{ document.getElementById('loginPanel').style.display='none'; }

/* Signup / Login */
document.getElementById('btnSignup').onclick = ()=>{
  const email = document.getElementById('suEmail').value.trim();
  const pass = document.getElementById('suPass').value;
  if(!email||!pass){ alert('Preencha email e senha'); return; }
  const users = loadUsers();
  if(users[email]){ alert('Conta j√° existe ‚Äî fa√ßa login'); return; }
  users[email] = {password: btoa(pass)};
  saveUsers(users);
  const db = loadData(); db[email] = db[email] || {records:[], meta:{}};
  saveData(db);
  setCurrent(email);
  alert('Conta criada e logado: ' + email);
};

document.getElementById('btnLogin').onclick = ()=>{
  const email = document.getElementById('liEmail').value.trim();
  const pass = document.getElementById('liPass').value;
  const users = loadUsers();
  if(!users[email] || users[email].password !== btoa(pass)){ alert('Email ou senha inv√°lidos'); return; }
  setCurrent(email);
  alert('Logado: ' + email);
};

document.getElementById('btnLogout').onclick = ()=>{ localStorage.removeItem('p75_current'); renderAuthState(); };

/* ---------- Measurements saving & history ---------- */
function renderAuthState(){
  const cur = getCurrent();
  document.getElementById('authForms').style.display = cur ? 'none':'block';
  document.getElementById('logged').style.display = cur ? 'block':'none';
  document.getElementById('measuresCard').style.display = cur ? 'block':'none';
  if(cur) document.getElementById('userEmail').textContent = cur;
  renderHistory();
  updateProgressVisual();
}

document.getElementById('btnSave').onclick = ()=>{
  const cur = getCurrent(); if(!cur){ alert('Fa√ßa login'); return; }
  const sex = document.querySelector('input[name="sex"]:checked').value;
  const peso = parseFloat(document.getElementById('pesoAtual').value);
  const meta = parseFloat(document.getElementById('pesoMeta').value);
  const cintura = parseFloat(document.getElementById('cintura').value||0);
  const peito = parseFloat(document.getElementById('peito').value||0);
  const braco = parseFloat(document.getElementById('braco').value||0);
  const perna = parseFloat(document.getElementById('perna').value||0);
  const bodyType = document.getElementById('bodyType').value;
  if(isNaN(peso) || isNaN(meta)){ alert('Informe peso atual e meta'); return; }
  const rec = {date:new Date().toISOString(), peso, cintura, peito, braco, perna, sex, bodyType};
  const db = loadData(); db[cur] = db[cur] || {records:[], meta:{}};
  db[cur].records.unshift(rec);
  db[cur].meta = {pesoMeta:meta};
  saveData(db);
  renderHistory();
  updateProgressVisual();
  if(window.updateAvatarPhase) window.updateAvatarPhase();
  document.getElementById('motivation').textContent = pickMessage(getProgressPercent());
  alert('Medida salva!');
};

document.getElementById('btnClear').onclick = ()=>{
  const cur = getCurrent(); if(!cur){ alert('Fa√ßa login'); return; }
  const db = loadData(); db[cur] = {records:[], meta:{}}; saveData(db); renderHistory(); updateProgressVisual();
  if(window.updateAvatarPhase) window.updateAvatarPhase();
  alert('Hist√≥rico limpo!');
};

function renderHistory(){
  const cur = getCurrent(); if(!cur) return;
  const db = loadData();
  const box = document.getElementById('historyBox');
  const data = db[cur] || {records:[]};
  if(!data.records.length){ box.innerHTML = '<div class="small">Sem medi√ß√µes ainda.</div>'; return; }
  box.innerHTML = data.records.map(r=>{
    const d = new Date(r.date);
    return `<div style="padding:6px 0;border-bottom:1px solid #f0f0f0"><strong>${d.toLocaleDateString()}</strong> ‚Äî ${r.peso} kg ‚Äî Cintura: ${r.cintura||'-'} cm ‚Äî Bra√ßo: ${r.braco||'-'} cm ‚Äî Perna: ${r.perna||'-'} cm</div>`;
  }).join('');
}

/* ---------- Progress calculation (ponderada) ---------- */
function clamp01(v){ return Math.max(0, Math.min(1, isFinite(v)?v:0)); }
function getInitial(records){ if(!records.length) return null; return records[records.length-1]; }

function getProgressPercent(){
  const cur = getCurrent(); if(!cur) return 0;
  const db = loadData(); const d = db[cur]; if(!d || !d.records.length || !d.meta || !d.meta.pesoMeta) return 0;
  const latest = d.records[0], initial = getInitial(d.records) || latest;
  const goal = d.meta.pesoMeta;

  // weight progress (50% weight)
  let weightProg = 0;
  if(goal < initial.peso) weightProg = ((initial.peso - latest.peso) / (initial.peso - goal));
  else weightProg = ((latest.peso - initial.peso) / (goal - initial.peso));
  weightProg = clamp01(weightProg);

  // heuristics for circumference/shape
  const bt = d.bodyType || latest.bodyType || 'normal';
  const cinturaTarget = bt === 'seco' ? (initial.cintura ? initial.cintura*0.9 : initial.cintura) : (initial.cintura ? initial.cintura*0.95 : initial.cintura);
  const peitoTarget = bt === 'musculoso' ? (initial.peito ? initial.peito*1.08 : initial.peito) : (initial.peito ? initial.peito*0.98 : initial.peito);
  const bracoTarget = bt === 'musculoso' ? (initial.braco ? initial.braco*1.08 : initial.braco) : (initial.braco ? initial.braco*0.95 : initial.braco);
  const pernaTarget = bt === 'musculoso' ? (initial.perna ? initial.perna*1.06 : initial.perna) : (initial.perna ? initial.perna*0.97 : initial.perna);

  function singleProgress(current, initialVal, target, reduceIfHigher=true){
    if(!initialVal || !current) return 0;
    if(reduceIfHigher){
      const denom = initialVal - target; if(denom===0) return 0;
      return clamp01((initialVal - current) / denom);
    } else {
      const denom = target - initialVal; if(denom===0) return 0;
      return clamp01((current - initialVal) / denom);
    }
  }

  const cinturaProg = singleProgress(latest.cintura, initial.cintura, cinturaTarget, true);
  const peitoProg = bt === 'musculoso' ? singleProgress(latest.peito, initial.peito, peitoTarget, false) : singleProgress(latest.peito, initial.peito, peitoTarget, true);
  const bracoProg = bt === 'musculoso' ? singleProgress(latest.braco, initial.braco, bracoTarget, false) : singleProgress(latest.braco, initial.braco, bracoTarget, true);
  const pernaProg = bt === 'musculoso' ? singleProgress(latest.perna, initial.perna, pernaTarget, false) : singleProgress(latest.perna, initial.perna, pernaTarget, true);

  const wWeight = 0.5, wCint = 0.15, wPeito = 0.10, wBraco = 0.125, wPerna = 0.125;
  const combined = (weightProg * wWeight) + (cinturaProg * wCint) + (peitoProg * wPeito) + (bracoProg * wBraco) + (pernaProg * wPerna);
  return Math.round(clamp01(combined) * 100);
}

/* ---------- Avatar update logic (shows correct SVG phase based on percent & sex) ---------- */
function pickMessage(percent){
  if(percent < 35) return ['Bora come√ßar! Um passo de cada vez üí™','Vamos com calma ‚Äî voc√™ j√° come√ßou!','Pequenas vit√≥rias. Grande resultado!'][Math.floor(Math.random()*3)];
  if(percent < 75) return ['T√° indo bem ‚Äî continue assim! üî•','Metade do caminho! N√£o pare agora.','Que evolu√ß√£o! Siga firme.'][Math.floor(Math.random()*3)];
  return ['Quase l√°! √öltimo esfor√ßo üèÅ','Meta √† vista ‚Äî manda ver!','Incr√≠vel! S√≥ falta o toque final.'][Math.floor(Math.random()*3)];
}

function updateProgressVisual(){
  const pct = getProgressPercent();
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('percentText').textContent = pct + '%';
  document.getElementById('motivation').textContent = pickMessage(pct);
  updateAvatarPhase(); // will show correct phase
}

/* Exposed: updateAvatarPhase reads percentText and sex radio */
function updateAvatarPhase(){
  const pct = parseInt(document.getElementById('percentText').textContent) || 0;
  const sexEl = document.querySelector('input[name="sex"]:checked');
  let sex = sexEl ? sexEl.value : 'male';
  // prefer latest recorded sex if user exists
  const cur = getCurrent();
  if(cur){
    const db = loadData(); const user = db[cur];
    if(user && user.records && user.records[0] && user.records[0].sex) sex = user.records[0].sex;
  }
  const phaseIndex = pct <= 33 ? 1 : (pct <= 66 ? 2 : 3);
  // hide all
  ['male_p1','male_p2','male_p3','female_p1','female_p2','female_p3'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.style.opacity = 0;
  });
  const idToShow = (sex === 'female' ? 'female_p' : 'male_p') + phaseIndex;
  const el = document.getElementById(idToShow);
  if(el) el.style.opacity = 1;
}

/* ---------- UI handlers ---------- */
document.getElementById('btnPreview').onclick = ()=>{
  updateProgressVisual();
  alert('Avatar atualizado (visual).');
};

/* initialize */
renderAuthState();
</script>
</body>
</html>
