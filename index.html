<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dark Premium ‚Äì Sua evolu√ß√£o come√ßa aqui</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05060a;
      --card: #101320;
      --accent: #4cc9f0;
      --accent2: #f72585;
      --accent3: #b8ff39;
      --text: #f5f5f5;
      --muted: #8a8fa3;
      --border: #212435;
      --danger: #ff4d6a;
      --good: #3ad29f;
    }
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #171b30, #05060a);
      color: var(--text);
      min-height: 100vh;
    }
    .shell {
      max-width: 1180px;
      margin: 0 auto;
      padding: 18px 12px 40px;
    }
    .card {
      background: linear-gradient(145deg, #111525, #060711);
      border-radius: 18px;
      padding: 16px 14px;
      border: 1px solid var(--border);
      box-shadow: 0 18px 55px rgba(0,0,0,0.6);
      margin-bottom: 16px;
    }
    .card-tight {
      padding: 12px 10px;
    }
    h1, h2, h3, h4 {
      margin: 0 0 8px;
    }
    h1 {
      font-size: 1.7rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    h2 {
      font-size: 1.1rem;
    }
    .tagline {
      margin-top: 4px;
      font-size: 0.9rem;
      color: var(--muted);
    }
    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .badge {
      font-size: 0.7rem;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
    }
    .badge-accent {
      border-color: var(--accent);
      color: var(--accent);
    }
    .badge-danger {
      border-color: var(--danger);
      color: var(--danger);
    }
    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--muted);
    }
    .meta-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.65rem;
      color: #6b7086;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 14px;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }
    .grid-4 {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }
    @media (max-width: 900px) {
      .grid-2 {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    @media (max-width: 720px) {
      .grid-3 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .grid-4 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 480px) {
      .grid-3, .grid-4 {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    label {
      display: block;
      font-size: 0.75rem;
      margin-bottom: 3px;
      color: var(--muted);
    }
    input, select, textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 9px;
      border: 1px solid var(--border);
      background: #070910;
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
    }
    textarea {
      min-height: 56px;
      resize: vertical;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(76,201,240,0.3);
    }

    .small {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    button {
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.8rem;
      padding: 9px 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #4895ef);
      color: #020308;
      box-shadow: 0 10px 26px rgba(72,149,239,0.4);
    }
    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
    }
    .btn-danger {
      background: transparent;
      border: 1px solid var(--danger);
      color: var(--danger);
    }
    .btn-full {
      flex: 1;
    }
    @media (max-width: 600px) {
      .btn-row {
        flex-direction: column;
      }
      .btn-full {
        width: 100%;
      }
    }

    .pill {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 0.7rem;
      color: var(--muted);
    }
    .pill-tag {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,0.01);
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .kpi-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 8px;
    }
    @media (max-width: 720px) {
      .kpi-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 480px) {
      .kpi-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .kpi {
      background: #080b14;
      border-radius: 12px;
      padding: 8px 9px;
      border: 1px solid var(--border);
      font-size: 0.8rem;
    }
    .kpi-label {
      font-size: 0.7rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .kpi-value {
      margin-top: 3px;
      font-size: 1rem;
      font-weight: 600;
    }
    .kpi-helper {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .progress-bar-wrap {
      margin-top: 6px;
    }
    .progress-bar-track {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #050712;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent2), var(--accent3));
      transition: width 0.4s ease-out;
    }
    .progress-text {
      font-size: 0.75rem;
      margin-top: 4px;
      color: var(--muted);
    }

    .table-wrap {
      overflow-x: auto;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #05060b;
      -webkit-overflow-scrolling: touch;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      min-width: 620px;
    }
    thead {
      background: linear-gradient(90deg, #101320, #15192a);
    }
    th, td {
      padding: 7px 8px;
      text-align: left;
      white-space: nowrap;
    }
    th {
      font-weight: 600;
      font-size: 0.75rem;
      color: #c4c7de;
      border-bottom: 1px solid var(--border);
    }
    tbody tr:nth-child(even) {
      background: rgba(255,255,255,0.02);
    }
    tbody tr:hover {
      background: rgba(76,201,240,0.05);
    }

    .flex {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .motivation-box {
      margin-top: 8px;
      padding: 8px 9px;
      border-radius: 12px;
      background: #090b15;
      border: 1px solid rgba(184,255,57,0.4);
      font-size: 0.8rem;
    }
    .motivation-emoji {
      font-size: 1.2rem;
      margin-right: 4px;
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }
    .tab-btn {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      font-size: 0.75rem;
      cursor: pointer;
    }
    .tab-btn.active {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(76,201,240,0.1);
    }

    .exercise-day {
      margin-bottom: 8px;
      padding: 6px 8px;
      border-radius: 10px;
      background: #090c16;
      border: 1px solid var(--border);
    }
    .exercise-day-header {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .exercise-item {
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 2px;
    }
    .exercise-item input[type="checkbox"] {
      width: 14px;
      height: 14px;
    }

    .badge-status-good {
      color: var(--good);
      border-color: var(--good);
    }
    .badge-status-bad {
      color: var(--danger);
      border-color: var(--danger);
    }

    .login-shell {
      max-width: 420px;
      margin: 40px auto;
      padding: 20px 16px 40px;
    }
    .center {
      text-align: center;
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.45rem;
      }
      .shell {
        padding: 16px 10px 32px;
      }
      .card {
        padding: 14px 11px;
        border-radius: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- √ÅREA DE LOGIN / CADASTRO -->
  <div id="authView" class="login-shell" style="display:none;">
    <div class="card">
      <h1>Dark Premium</h1>
      <p class="tagline">Sua evolu√ß√£o come√ßa aqui. Login ou crie sua conta.</p>

      <div class="tabs" style="margin-top:10px;">
        <button class="tab-btn active" id="tabLogin">Login</button>
        <button class="tab-btn" id="tabRegister">Criar conta</button>
      </div>

      <div id="loginForm">
        <label for="loginEmail">E-mail</label>
        <input type="email" id="loginEmail" placeholder="voce@exemplo.com" />
        <label for="loginPassword" style="margin-top:6px;">Senha</label>
        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        <div class="btn-row" style="margin-top:12px;">
          <button class="btn-primary btn-full" id="loginBtn">Entrar</button>
        </div>
      </div>

      <div id="registerForm" style="display:none;">
        <label for="registerName">Nome</label>
        <input type="text" id="registerName" placeholder="Seu nome" />
        <label for="registerEmail" style="margin-top:6px;">E-mail</label>
        <input type="email" id="registerEmail" placeholder="voce@exemplo.com" />
        <label for="registerPassword" style="margin-top:6px;">Senha</label>
        <input type="password" id="registerPassword" placeholder="m√≠nimo 6 caracteres" />
        <div class="btn-row" style="margin-top:12px;">
          <button class="btn-primary btn-full" id="registerBtn">Criar conta</button>
        </div>
      </div>

      <p class="small" id="authMessage"></p>
    </div>
  </div>

  <!-- APLICATIVO PRINCIPAL -->
  <div id="appView" class="shell" style="display:none;">

    <!-- HEADER / USU√ÅRIO -->
    <div class="card">
      <div class="flex" style="justify-content:space-between;align-items:flex-start;">
        <div>
          <h1>Dark Premium</h1>
          <p class="tagline">
            Sua evolu√ß√£o come√ßa aqui. Acompanhamento de peso, IMC, treinos e dieta ‚Äì tudo em um s√≥ painel.
          </p>
          <div class="badge-row">
            <span class="badge badge-accent" id="userNameBadge">Ol√°, atleta üëã</span>
            <span class="badge" id="userEmailBadge"></span>
            <span class="badge">Dom√≠nio: projeto.esoares.net.br</span>
          </div>
        </div>
        <div class="btn-row" style="margin-top:0;">
          <button class="btn-ghost" id="logoutBtn">Sair</button>
        </div>
      </div>
      <div class="meta-row">
        <div>
          <div class="meta-label">Status</div>
          <div id="statusText">Carregando seu perfil...</div>
        </div>
        <div>
          <div class="meta-label">Objetivo atual</div>
          <div id="statusGoal">-</div>
        </div>
        <div>
          <div class="meta-label">Humor do coach</div>
          <div id="statusCoach">Aguardando dados pra come√ßar a zoar üòè</div>
        </div>
      </div>
      <div id="motivationBox" class="motivation-box" style="display:none;">
        <span class="motivation-emoji" id="motivationEmoji">üî•</span>
        <span id="motivationText"></span>
      </div>
    </div>

    <!-- TOPO: PERFIL+METAS (COMPACTO) + DASH -->
    <div class="grid-2">
      <!-- PERFIL & METAS (mais compacto) -->
      <div class="card card-tight">
        <h2>Perfil & metas</h2>
        <p class="small">
          Campos b√°sicos bem compactos pra n√£o ocupar a tela inteira.
        </p>
        <div class="grid-4" style="margin-top:6px;">
          <div>
            <label for="profileName">Nome</label>
            <input id="profileName" type="text" placeholder="Seu nome" />
          </div>
          <div>
            <label for="profileSex">Sexo</label>
            <select id="profileSex">
              <option value="">Selecione</option>
              <option value="M">Masculino</option>
              <option value="F">Feminino</option>
              <option value="O">Outro / Prefiro n√£o dizer</option>
            </select>
          </div>
          <div>
            <label for="profileHeight">Altura (cm)</label>
            <input id="profileHeight" type="number" min="120" max="230" placeholder="Ex: 175" />
          </div>
          <div>
            <label for="profileAge">Idade</label>
            <input id="profileAge" type="number" min="10" max="99" placeholder="Ex: 35" />
          </div>
        </div>

        <div class="grid-4" style="margin-top:6px;">
          <div>
            <label for="startWeight">Peso inicial (kg)</label>
            <input id="startWeight" type="number" step="0.1" placeholder="Ex: 89" />
          </div>
          <div>
            <label for="goalWeight">Meta de peso (kg)</label>
            <input id="goalWeight" type="number" step="0.1" placeholder="Ex: 75" />
          </div>
          <div>
            <label for="goalType">Objetivo</label>
            <select id="goalType">
              <option value="">Selecione</option>
              <option value="perda">Perda de gordura</option>
              <option value="manutencao">Sa√∫de / Manuten√ß√£o</option>
              <option value="hipertrofia">Hipertrofia</option>
            </select>
          </div>
          <div>
            <label for="trainingFreq">Treinos/semana</label>
            <select id="trainingFreq">
              <option value="">Selecione</option>
              <option value="3">3x</option>
              <option value="4">4x</option>
              <option value="5">5x</option>
              <option value="6">6x</option>
            </select>
          </div>
        </div>

        <div class="grid-2" style="margin-top:6px;">
          <div>
            <label for="dietType">Dieta</label>
            <select id="dietType">
              <option value="">Selecione</option>
              <option value="lowcarb">Low carb</option>
              <option value="hiperproteica">Hiperproteica / hipertrofia</option>
              <option value="mediterranea">Mediterr√¢nea</option>
            </select>
          </div>
          <div>
            <label for="supplementsUser">Suplementos que voc√™ usa</label>
            <input id="supplementsUser" type="text" placeholder="Ex: whey, creatina, omega 3" />
          </div>
        </div>

        <div class="btn-row">
          <button class="btn-primary btn-full" id="saveProfileBtn">Salvar perfil & metas</button>
        </div>

        <details style="margin-top:8px;">
          <summary class="small">Seguran√ßa (nome de exibi√ß√£o & senha)</summary>
          <div class="small" style="margin-top:6px;">
            <label for="displayNameUpdate">Nome de exibi√ß√£o</label>
            <input id="displayNameUpdate" type="text" placeholder="Exibido no topo" />
            <div class="btn-row" style="margin-top:6px;">
              <button class="btn-ghost" id="updateNameBtn">Atualizar nome</button>
            </div>

            <label for="newPassword" style="margin-top:8px;">Nova senha</label>
            <input id="newPassword" type="password" placeholder="m√≠nimo 6 caracteres" />
            <div class="btn-row" style="margin-top:6px;">
              <button class="btn-danger" id="updatePasswordBtn">Trocar senha</button>
            </div>
          </div>
        </details>

        <p class="small" id="profileMessage"></p>
      </div>

      <!-- DASH PRINCIPAL: Peso + IMC + barra de evolu√ß√£o -->
      <div class="card card-tight">
        <h2>Dashboard r√°pido</h2>
        <p class="small">
          Peso, IMC e treinos num painel s√≥. Sem drama.
        </p>

        <div class="kpi-row">
          <div class="kpi">
            <div class="kpi-label">Peso atual</div>
            <div class="kpi-value" id="kpiWeight">-</div>
            <div class="kpi-helper" id="kpiWeightHelper">Registre pelo menos uma semana.</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">IMC</div>
            <div class="kpi-value" id="kpiBmi">-</div>
            <div class="kpi-helper" id="kpiBmiHelper">Informe altura & peso.</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Frequ√™ncia da semana</div>
            <div class="kpi-value" id="kpiFreq">0 / 0</div>
            <div class="kpi-helper" id="kpiFreqHelper">Complete os treinos pra ver a magia.</div>
          </div>
        </div>

        <div class="progress-bar-wrap">
          <div class="flex" style="justify-content:space-between;">
            <span class="kpi-label">Progresso at√© a meta</span>
            <span class="kpi-label" id="progressPercentLabel">0%</span>
          </div>
          <div class="progress-bar-track">
            <div class="progress-bar-fill" id="progressBarFill"></div>
          </div>
          <div class="progress-text" id="progressText">
            Falta registrar peso pra eu poder te julgar com propriedade üòÖ
          </div>
        </div>

        <div class="small" style="margin-top:8px;">
          Gr√°fico abaixo: peso e IMC juntos. Spoiler: a linha tem que descer se a meta √© emagrecer.
        </div>
      </div>
    </div>

    <!-- GR√ÅFICOS + REGISTRO SEMANAL -->
    <div class="grid-2">
      <!-- Gr√°fico -->
      <div class="card card-tight">
        <h2>Gr√°ficos ‚Äì Peso & IMC</h2>
        <p class="small">
          Azul = peso (kg) ‚Ä¢ Rosa = IMC. Tend√™ncia √© o que importa.
        </p>
        <div style="position:relative; height:260px; margin-top:6px;">
          <canvas id="mainChart"></canvas>
        </div>
      </div>

      <!-- Registro semanal -->
      <div class="card card-tight">
        <h2>Registrar semana</h2>
        <p class="small">
          Salvo no Firebase. Voc√™ pode acessar do celular, notebook, geladeira inteligente etc.
        </p>

        <div class="grid-3" style="margin-top:6px;">
          <div>
            <label for="weekSelect">Semana</label>
            <select id="weekSelect">
              <option value="">Selecione...</option>
              <option value="1">Semana 1</option>
              <option value="2">Semana 2</option>
              <option value="3">Semana 3</option>
              <option value="4">Semana 4</option>
              <option value="5">Semana 5</option>
              <option value="6">Semana 6</option>
              <option value="7">Semana 7</option>
              <option value="8">Semana 8</option>
              <option value="9">Semana 9</option>
              <option value="10">Semana 10</option>
              <option value="11">Semana 11</option>
              <option value="12">Semana 12</option>
            </select>
          </div>
          <div>
            <label for="weekWeight">Peso (kg)</label>
            <input id="weekWeight" type="number" step="0.1" placeholder="Ex: 87.0" />
          </div>
          <div>
            <label for="weekWaist">Cintura (cm)</label>
            <input id="weekWaist" type="number" step="0.1" placeholder="Ex: 90" />
          </div>
        </div>

        <div class="grid-3" style="margin-top:6px;">
          <div>
            <label for="weekEnergy">Energia (1‚Äì10)</label>
            <input id="weekEnergy" type="number" min="1" max="10" />
          </div>
          <div>
            <label for="weekMood">Humor (1‚Äì10)</label>
            <input id="weekMood" type="number" min="1" max="10" />
          </div>
          <div>
            <label for="weekSleep">Sono (1‚Äì10)</label>
            <input id="weekSleep" type="number" min="1" max="10" />
          </div>
        </div>

        <div style="margin-top:6px;">
          <label for="weekNotes">Observa√ß√µes</label>
          <input id="weekNotes" type="text" placeholder="Ex: mais cardio, menos fome, TPM atacando..." />
        </div>

        <div class="btn-row">
          <button class="btn-primary btn-full" id="saveWeekBtn">Salvar semana</button>
        </div>

        <p class="small" id="weekMessage"></p>
      </div>
    </div>

    <!-- Hist√≥rico -->
    <div class="card card-tight">
      <h2>Hist√≥rico completo</h2>
      <p class="small">
        Di√°rio de progresso. Usa o que t√° aqui pra discutir com o m√©dico e n√£o com o espelho.
      </p>
      <div class="table-wrap" style="margin-top:6px;">
        <table id="historyTable">
          <thead>
            <tr>
              <th>Semana</th>
              <th>Peso (kg)</th>
              <th>Cintura (cm)</th>
              <th>IMC</th>
              <th>Energia</th>
              <th>Humor</th>
              <th>Sono</th>
              <th>Observa√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <!-- preenchido via JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- TREINOS ‚Äì POR OBJETIVO, FREQU√äNCIA & DIA DA SEMANA -->
    <div class="card card-tight">
      <h2>Treinos recomendados por objetivo</h2>
      <p class="small">
        Os treinos abaixo mudam conforme <strong>objetivo</strong> e <strong>frequ√™ncia semanal</strong. 
        Use os checkboxes pra marcar o que fez na semana.
      </p>

      <div class="pill-row" id="trainingSummaryRow">
        <!-- preenchido via JS -->
      </div>

      <div class="progress-bar-wrap" style="margin-top:10px;">
        <div class="flex" style="justify-content:space-between;">
          <span class="kpi-label">Frequ√™ncia da semana</span>
          <span class="kpi-label" id="trainingFreqLabel">0 / 0</span>
        </div>
        <div class="progress-bar-track">
          <div class="progress-bar-fill" id="trainingBarFill"></div>
        </div>
        <div class="progress-text" id="trainingText"></div>
      </div>

      <div id="trainingPlan" style="margin-top:10px;">
        <!-- dias & exerc√≠cios via JS -->
      </div>

      <p class="small">
        Dica: se voc√™ marcar ‚Äúperda de gordura + 5x/semana‚Äù, o plano fica mais puxado. Se marcar e n√£o treinar, a culpa √© do bot√£o, n√£o sua. √ìbvio.
      </p>
    </div>

    <!-- NUTRI√á√ÉO ‚Äì DIETA + TABELA DE ALIMENTOS + CARD√ÅPIO EXEMPLO -->
    <div class="card card-tight">
      <h2>Nutri√ß√£o & Dietas</h2>
      <p class="small">
        Seleciona a dieta no topo (perfil) e eu te mostro: alimentos recomendados, evitar e um card√°pio exemplo.
      </p>

      <div id="dietInfo">
        <!-- preenchido via JS -->
      </div>
    </div>

    <!-- SUPLEMENTOS & HOR√ÅRIOS -->
    <div class="card card-tight">
      <h2>Suplementos & hor√°rios sugeridos</h2>
      <p class="small">
        Escreva o que voc√™ usa em <strong>‚ÄúSuplementos que voc√™ usa‚Äù</strong> no perfil (ex: whey, creatina, omega 3). 
        Aqui aparecem as sugest√µes de hor√°rio para <strong>cada</strong> suplemento reconhecido.
      </p>
      <div id="supplementsSuggestions">
        <!-- preenchido via JS -->
      </div>
      <p class="small">
        Sempre siga a orienta√ß√£o do seu m√©dico. Eu sou s√≥ um app estiloso, n√£o um CRM.
      </p>
    </div>

  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase (modular) -->
  <script type="module">
    // Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      updatePassword,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // === CONFIG DO SEU PROJETO (que voc√™ me mandou) ===
    const firebaseConfig = {
      apiKey: "AIzaSyBbz-DjxSv2S2g1qkWca8YpNn3g7C4Oic0",
      authDomain: "evolucao-dark-premium.firebaseapp.com",
      projectId: "evolucao-dark-premium",
      storageBucket: "evolucao-dark-premium.firebasestorage.app",
      messagingSenderId: "1041789751060",
      appId: "1:1041789751060:web:eb2afd0d1a4af526e0fc01"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // === ELEMENTOS B√ÅSICOS ===
    const authView = document.getElementById("authView");
    const appView = document.getElementById("appView");

    const tabLogin = document.getElementById("tabLogin");
    const tabRegister = document.getElementById("tabRegister");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");
    const authMessage = document.getElementById("authMessage");

    const loginEmail = document.getElementById("loginEmail");
    const loginPassword = document.getElementById("loginPassword");
    const loginBtn = document.getElementById("loginBtn");

    const registerName = document.getElementById("registerName");
    const registerEmail = document.getElementById("registerEmail");
    const registerPassword = document.getElementById("registerPassword");
    const registerBtn = document.getElementById("registerBtn");

    const logoutBtn = document.getElementById("logoutBtn");

    // Perfil
    const userNameBadge = document.getElementById("userNameBadge");
    const userEmailBadge = document.getElementById("userEmailBadge");
    const statusText = document.getElementById("statusText");
    const statusGoal = document.getElementById("statusGoal");
    const statusCoach = document.getElementById("statusCoach");
    const motivationBox = document.getElementById("motivationBox");
    const motivationEmoji = document.getElementById("motivationEmoji");
    const motivationText = document.getElementById("motivationText");

    const profileName = document.getElementById("profileName");
    const profileSex = document.getElementById("profileSex");
    const profileHeight = document.getElementById("profileHeight");
    const profileAge = document.getElementById("profileAge");
    const startWeight = document.getElementById("startWeight");
    const goalWeight = document.getElementById("goalWeight");
    const goalType = document.getElementById("goalType");
    const trainingFreq = document.getElementById("trainingFreq");
    const dietType = document.getElementById("dietType");
    const supplementsUser = document.getElementById("supplementsUser");
    const saveProfileBtn = document.getElementById("saveProfileBtn");
    const profileMessage = document.getElementById("profileMessage");

    const displayNameUpdate = document.getElementById("displayNameUpdate");
    const updateNameBtn = document.getElementById("updateNameBtn");
    const newPassword = document.getElementById("newPassword");
    const updatePasswordBtn = document.getElementById("updatePasswordBtn");

    // Dashboard
    const kpiWeight = document.getElementById("kpiWeight");
    const kpiWeightHelper = document.getElementById("kpiWeightHelper");
    const kpiBmi = document.getElementById("kpiBmi");
    const kpiBmiHelper = document.getElementById("kpiBmiHelper");
    const kpiFreq = document.getElementById("kpiFreq");
    const kpiFreqHelper = document.getElementById("kpiFreqHelper");

    const progressBarFill = document.getElementById("progressBarFill");
    const progressPercentLabel = document.getElementById("progressPercentLabel");
    const progressText = document.getElementById("progressText");

    const mainChartCanvas = document.getElementById("mainChart");
    let mainChart = null;

    // Semana
    const weekSelect = document.getElementById("weekSelect");
    const weekWeight = document.getElementById("weekWeight");
    const weekWaist = document.getElementById("weekWaist");
    const weekEnergy = document.getElementById("weekEnergy");
    const weekMood = document.getElementById("weekMood");
    const weekSleep = document.getElementById("weekSleep");
    const weekNotes = document.getElementById("weekNotes");
    const saveWeekBtn = document.getElementById("saveWeekBtn");
    const weekMessage = document.getElementById("weekMessage");
    const historyTableBody = document.querySelector("#historyTable tbody");

    // Treinos
    const trainingPlanDiv = document.getElementById("trainingPlan");
    const trainingSummaryRow = document.getElementById("trainingSummaryRow");
    const trainingBarFill = document.getElementById("trainingBarFill");
    const trainingFreqLabel = document.getElementById("trainingFreqLabel");
    const trainingText = document.getElementById("trainingText");

    // Dieta & suplementos
    const dietInfoDiv = document.getElementById("dietInfo");
    const supplementsSuggestions = document.getElementById("supplementsSuggestions");

    // Estado em mem√≥ria
    let currentUser = null;
    let profileData = {};
    let progressData = []; // array de objetos {week, weight, waist, energy,...}

    // === TABS LOGIN / REGISTER ===
    tabLogin.addEventListener("click", () => {
      tabLogin.classList.add("active");
      tabRegister.classList.remove("active");
      loginForm.style.display = "";
      registerForm.style.display = "none";
      authMessage.textContent = "";
    });
    tabRegister.addEventListener("click", () => {
      tabRegister.classList.add("active");
      tabLogin.classList.remove("active");
      loginForm.style.display = "none";
      registerForm.style.display = "";
      authMessage.textContent = "";
    });

    // === AUTENTICA√á√ÉO ===
    loginBtn.addEventListener("click", async () => {
      authMessage.textContent = "";
      try {
        await signInWithEmailAndPassword(auth, loginEmail.value.trim(), loginPassword.value);
      } catch (e) {
        authMessage.textContent = "Erro ao fazer login: " + e.message;
      }
    });

    registerBtn.addEventListener("click", async () => {
      authMessage.textContent = "";
      try {
        const cred = await createUserWithEmailAndPassword(
          auth,
          registerEmail.value.trim(),
          registerPassword.value
        );
        await updateProfile(cred.user, { displayName: registerName.value.trim() || "Atleta" });
        // cria perfil b√°sico
        await setDoc(doc(db, "users", cred.user.uid), {
          name: registerName.value.trim() || "",
          sex: "",
          height: null,
          age: null,
          startWeight: null,
          goalWeight: null,
          goalType: "",
          trainingFreq: "",
          dietType: "",
          supplementsUser: "",
          createdAt: new Date().toISOString()
        });
      } catch (e) {
        authMessage.textContent = "Erro ao criar conta: " + e.message;
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // Atualizar nome & senha
    updateNameBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      try {
        await updateProfile(currentUser, { displayName: displayNameUpdate.value.trim() });
        userNameBadge.textContent = displayNameUpdate.value.trim()
          ? displayNameUpdate.value.trim()
          : "Atleta misterioso(a)";
        profileMessage.textContent = "Nome de exibi√ß√£o atualizado.";
      } catch (e) {
        profileMessage.textContent = "Erro ao atualizar nome: " + e.message;
      }
    });

    updatePasswordBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      if (!newPassword.value || newPassword.value.length < 6) {
        profileMessage.textContent = "A nova senha deve ter pelo menos 6 caracteres.";
        return;
      }
      try {
        await updatePassword(currentUser, newPassword.value);
        profileMessage.textContent = "Senha atualizada com sucesso.";
        newPassword.value = "";
      } catch (e) {
        profileMessage.textContent = "Erro ao trocar senha: " + e.message;
      }
    });

    // === FIREBASE: OBSERVA USER ===
    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (!user) {
        appView.style.display = "none";
        authView.style.display = "block";
        return;
      }
      authView.style.display = "none";
      appView.style.display = "block";

      userEmailBadge.textContent = user.email || "";
      userNameBadge.textContent = user.displayName || "Atleta";

      await loadProfile();
      await loadProgress();
      updateAllUI();
    });

    // === CARREGAR / SALVAR PERFIL ===
    async function loadProfile() {
      if (!currentUser) return;
      const ref = doc(db, "users", currentUser.uid);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        profileData = snap.data();
      } else {
        profileData = {
          name: "",
          sex: "",
          height: null,
          age: null,
          startWeight: null,
          goalWeight: null,
          goalType: "",
          trainingFreq: "",
          dietType: "",
          supplementsUser: ""
        };
      }
      fillProfileForm();
    }

    function fillProfileForm() {
      profileName.value = profileData.name || "";
      profileSex.value = profileData.sex || "";
      profileHeight.value = profileData.height ?? "";
      profileAge.value = profileData.age ?? "";
      startWeight.value = profileData.startWeight ?? "";
      goalWeight.value = profileData.goalWeight ?? "";
      goalType.value = profileData.goalType || "";
      trainingFreq.value = profileData.trainingFreq || "";
      dietType.value = profileData.dietType || "";
      supplementsUser.value = profileData.supplementsUser || "";
      displayNameUpdate.value = currentUser?.displayName || "";
    }

    saveProfileBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      profileMessage.textContent = "Salvando...";
      const payload = {
        name: profileName.value.trim(),
        sex: profileSex.value,
        height: profileHeight.value ? Number(profileHeight.value) : null,
        age: profileAge.value ? Number(profileAge.value) : null,
        startWeight: startWeight.value ? Number(startWeight.value) : null,
        goalWeight: goalWeight.value ? Number(goalWeight.value) : null,
        goalType: goalType.value,
        trainingFreq: trainingFreq.value,
        dietType: dietType.value,
        supplementsUser: supplementsUser.value.trim()
      };
      try {
        await setDoc(doc(db, "users", currentUser.uid), payload, { merge: true });
        profileData = { ...profileData, ...payload };
        profileMessage.textContent = "Perfil salvo com sucesso.";
        updateAllUI();
      } catch (e) {
        profileMessage.textContent = "Erro ao salvar perfil: " + e.message;
      }
    });

    // === PROGRESSO SEMANAL ===
    async function loadProgress() {
      if (!currentUser) return;
      const colRef = collection(db, "users", currentUser.uid, "progress");
      const snap = await getDocs(colRef);
      const rows = [];
      snap.forEach((docSnap) => {
        rows.push(docSnap.data());
      });
      // ordenar por semana
      rows.sort((a, b) => (a.week || 0) - (b.week || 0));
      progressData = rows;
    }

    saveWeekBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      const w = parseInt(weekSelect.value, 10);
      if (!w || isNaN(w)) {
        weekMessage.textContent = "Selecione a semana.";
        return;
      }
      const weightVal = weekWeight.value.replace(",", ".");
      const weightNum = parseFloat(weightVal);
      if (isNaN(weightNum)) {
        weekMessage.textContent = "Informe o peso (kg).";
        return;
      }
      const waistVal = weekWaist.value ? parseFloat(weekWaist.value.replace(",", ".")) : null;
      const energyVal = weekEnergy.value ? parseInt(weekEnergy.value, 10) : null;
      const moodVal = weekMood.value ? parseInt(weekMood.value, 10) : null;
      const sleepVal = weekSleep.value ? parseInt(weekSleep.value, 10) : null;
      const notesVal = weekNotes.value.trim();

      const docId = "week_" + w;
      const payload = {
        week: w,
        weight: weightNum,
        waist: waistVal,
        energy: energyVal,
        mood: moodVal,
        sleep: sleepVal,
        notes: notesVal,
        updatedAt: new Date().toISOString()
      };

      try {
        await setDoc(doc(db, "users", currentUser.uid, "progress", docId), payload, { merge: true });
        weekMessage.textContent = "Semana salva com sucesso.";
        // atualiza progressData em mem√≥ria
        const existingIndex = progressData.findIndex((row) => row.week === w);
        if (existingIndex >= 0) {
          progressData[existingIndex] = { ...progressData[existingIndex], ...payload };
        } else {
          progressData.push(payload);
        }
        progressData.sort((a, b) => (a.week || 0) - (b.week || 0));
        updateAllUI();
      } catch (e) {
        weekMessage.textContent = "Erro ao salvar semana: " + e.message;
      }
    });

    // === UI: HIST√ìRICO, GR√ÅFICO, KPI, MOTIVA√á√ÉO ===
    function updateAllUI() {
      updateStatusTexts();
      renderHistoryTable();
      renderMainChart();
      updateDashboard();
      updateTrainingSection();
      renderDietInfo();
      renderSupplements();
    }

    function updateStatusTexts() {
      if (!profileData) return;
      const goalMap = {
        perda: "Perda de gordura",
        manutencao: "Sa√∫de / Manuten√ß√£o",
        hipertrofia: "Hipertrofia"
      };
      statusGoal.textContent = goalMap[profileData.goalType] || "Defina um objetivo nas metas";

      const last = progressData[progressData.length - 1];
      if (last) {
        statusText.textContent = `√öltimo registro: Semana ${last.week} ‚Äì ${last.weight?.toFixed(1) ?? "?"} kg`;
      } else {
        statusText.textContent = "Ainda sem registros de peso. Comece pela Semana 1.";
      }

      // Motiva√ß√£o engra√ßada com base na % da meta
      const { percent, msg, emoji } = buildMotivation();
      if (msg) {
        motivationBox.style.display = "block";
        motivationEmoji.textContent = emoji;
        motivationText.textContent = msg;
      } else {
        motivationBox.style.display = "none";
      }
    }

    function buildMotivation() {
      const start = profileData.startWeight;
      const goal = profileData.goalWeight;
      const last = progressData[progressData.length - 1];
      if (!start || !goal || !last?.weight) {
        return {
          percent: 0,
          msg: "Assim que voc√™ colocar peso inicial, meta e pelo menos um registro, eu viro seu coach meio t√≥xico, meio fofo.",
          emoji: "üßê"
        };
      }
      const initial = start;
      const target = goal;
      const isLoss = target < initial;
      const deltaGoal = Math.abs(initial - target);
      const deltaDone = Math.abs(initial - last.weight);
      const rawPercent = deltaGoal === 0 ? 0 : Math.min(100, Math.round((deltaDone / deltaGoal) * 100));
      let msg = "";
      let emoji = "üî•";
      if (rawPercent === 0) {
        msg = "Come√ßo oficial: j√° sabe o alvo. Agora √© s√≥ n√£o tratar pizza como patrim√¥nio cultural di√°rio.";
        emoji = "üéØ";
      } else if (rawPercent < 25) {
        msg = `Voc√™ j√° andou ${rawPercent}% do caminho. √â tipo subir um lance de escada: ainda d√≥i pouco. Aproveita.`;
        emoji = "üö∂‚Äç‚ôÇÔ∏è";
      } else if (rawPercent < 50) {
        msg = `${rawPercent}% da meta! J√° √© o suficiente pra aparecer nas fotos de lado. Continua!`;
        emoji = "üì∏";
      } else if (rawPercent < 75) {
        msg = `${rawPercent}% feito. A esta altura, o espelho j√° t√° mais seu amigo que o iFood.`;
        emoji = "üí™";
      } else if (rawPercent < 100) {
        msg = `${rawPercent}%! Voc√™ t√° mais perto da meta do que de desistir. E eu t√¥ aqui s√≥ vigiando.`;
        emoji = "üî•";
      } else {
        msg = `Meta batida! Agora o desafio √© n√£o comemorar comendo tudo que voc√™ cortou nos √∫ltimos meses.`;
        emoji = "üèÜ";
      }
      return { percent: rawPercent, msg, emoji };
    }

    function renderHistoryTable() {
      historyTableBody.innerHTML = "";
      const h = profileData.height ? profileData.height / 100 : null;
      const sorted = [...progressData].sort((a, b) => (a.week || 0) - (b.week || 0));
      for (const row of sorted) {
        const tr = document.createElement("tr");
        const bmi = h && row.weight ? (row.weight / (h * h)) : null;
        tr.innerHTML = `
          <td><span class="pill">Semana ${row.week ?? ""}</span></td>
          <td>${row.weight?.toFixed(1) ?? ""}</td>
          <td>${row.waist?.toFixed?.(1) ?? (row.waist ?? "")}</td>
          <td>${bmi ? bmi.toFixed(1) : ""}</td>
          <td>${row.energy ?? ""}</td>
          <td>${row.mood ?? ""}</td>
          <td>${row.sleep ?? ""}</td>
          <td>${row.notes ?? ""}</td>
        `;
        historyTableBody.appendChild(tr);
      }
    }

    function renderMainChart() {
      const sorted = [...progressData].sort((a, b) => (a.week || 0) - (b.week || 0));
      const labels = sorted.map((d) => "S" + d.week);
      const weights = sorted.map((d) => d.weight);
      const h = profileData.height ? profileData.height / 100 : null;
      const bmis = sorted.map((d) => {
        if (!h || !d.weight) return null;
        return d.weight / (h * h);
      });

      if (mainChart) {
        mainChart.destroy();
      }
      mainChart = new Chart(mainChartCanvas.getContext("2d"), {
        type: "line",
        data: {
          labels,
          datasets: [
            {
              label: "Peso (kg)",
              data: weights,
              borderColor: "#4cc9f0",
              backgroundColor: "rgba(76,201,240,0.1)",
              borderWidth: 2,
              tension: 0.35,
              pointRadius: 3,
              yAxisID: "y"
            },
            {
              label: "IMC",
              data: bmis,
              borderColor: "#f72585",
              backgroundColor: "rgba(247,37,133,0.1)",
              borderWidth: 2,
              tension: 0.35,
              pointRadius: 3,
              yAxisID: "y1"
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: "#d0d3ea", usePointStyle: true }
            }
          },
          scales: {
            x: {
              ticks: { color: "#9ba0c2" },
              grid: { color: "rgba(255,255,255,0.03)" }
            },
            y: {
              position: "left",
              ticks: { color: "#9ba0c2" },
              grid: { color: "rgba(255,255,255,0.03)" }
            },
            y1: {
              position: "right",
              ticks: { color: "#9ba0c2" },
              grid: { display: false }
            }
          }
        }
      });
    }

    function updateDashboard() {
      const last = progressData[progressData.length - 1];
      if (last?.weight) {
        kpiWeight.textContent = last.weight.toFixed(1) + " kg";
        kpiWeightHelper.textContent = "Semana " + last.week;
      } else {
        kpiWeight.textContent = "-";
        kpiWeightHelper.textContent = "Registre pelo menos uma semana.";
      }

      const h = profileData.height ? profileData.height / 100 : null;
      if (h && last?.weight) {
        const bmi = last.weight / (h * h);
        kpiBmi.textContent = bmi.toFixed(1);
        let classe = "";
        if (bmi < 18.5) classe = "Abaixo do peso";
        else if (bmi < 25) classe = "Normal";
        else if (bmi < 30) classe = "Sobrepeso";
        else classe = "Obesidade";
        kpiBmiHelper.textContent = classe;
      } else {
        kpiBmi.textContent = "-";
        kpiBmiHelper.textContent = "Informe altura & peso.";
      }

      // Progresso at√© meta
      const start = profileData.startWeight;
      const goal = profileData.goalWeight;
      if (start && goal && last?.weight) {
        const initial = start;
        const target = goal;
        const isLoss = target < initial;
        const deltaGoal = Math.abs(initial - target);
        const deltaDone = Math.abs(initial - last.weight);
        const rawPercent = deltaGoal === 0 ? 0 : Math.min(100, Math.round((deltaDone / deltaGoal) * 100));
        progressBarFill.style.width = rawPercent + "%";
        progressPercentLabel.textContent = rawPercent + "%";

        let txt = "";
        if (isLoss) {
          const lost = (initial - last.weight).toFixed(1);
          txt = `Voc√™ j√° perdeu ${lost} kg em dire√ß√£o √† meta.`;
        } else {
          const gained = (last.weight - initial).toFixed(1);
          txt = `Voc√™ j√° ganhou ${gained} kg em dire√ß√£o √† meta.`;
        }
        progressText.textContent = txt;
      } else {
        progressBarFill.style.width = "0%";
        progressPercentLabel.textContent = "0%";
        progressText.textContent = "Defina peso inicial, meta e registre pelo menos uma semana para ver a barra de evolu√ß√£o.";
      }

      // Frequ√™ncia (atualizada na se√ß√£o de treinos)
      // kpiFreq / kpiFreqHelper s√£o atualizados em updateTrainingSection()
    }

    // === TREINOS POR OBJETIVO / FREQU√äNCIA / DIA ===

    const daysOfWeek = ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado", "Domingo"];

    // Plano base: para cada objetivo + frequ√™ncia
    function getTrainingTemplate(goal, freq) {
      // resultado: objeto { "Segunda": [ {name, sets, reps}, ... ], ... }
      const f = parseInt(freq, 10);
      if (!goal || !f) return {};

      // Helpers pra montar
      const base = {
        "Full body leve": [
          { name: "Agachamento livre", sets: 3, reps: "10‚Äì12" },
          { name: "Supino reto", sets: 3, reps: "8‚Äì10" },
          { name: "Remada curvada", sets: 3, reps: "10‚Äì12" },
          { name: "Desenvolvimento ombro", sets: 3, reps: "10‚Äì12" },
          { name: "Prancha abdominal", sets: 3, reps: "30s" }
        ],
        "Upper": [
          { name: "Supino reto", sets: 4, reps: "8‚Äì10" },
          { name: "Remada baixa", sets: 4, reps: "8‚Äì10" },
          { name: "Desenvolvimento com halteres", sets: 3, reps: "10‚Äì12" },
          { name: "Rosca direta", sets: 3, reps: "10‚Äì12" },
          { name: "Tr√≠ceps corda", sets: 3, reps: "10‚Äì12" }
        ],
        "Lower": [
          { name: "Agachamento livre / smith", sets: 4, reps: "8‚Äì10" },
          { name: "Leg press", sets: 4, reps: "10‚Äì12" },
          { name: "Cadeira extensora", sets: 3, reps: "12‚Äì15" },
          { name: "Mesa flexora", sets: 3, reps: "10‚Äì12" },
          { name: "Panturrilha em p√©", sets: 3, reps: "12‚Äì15" }
        ],
        "Push": [
          { name: "Supino reto", sets: 4, reps: "6‚Äì10" },
          { name: "Supino inclinado", sets: 3, reps: "8‚Äì10" },
          { name: "Desenvolvimento militar", sets: 3, reps: "8‚Äì10" },
          { name: "Eleva√ß√£o lateral", sets: 3, reps: "12‚Äì15" },
          { name: "Tr√≠ceps franc√™s", sets: 3, reps: "10‚Äì12" }
        ],
        "Pull": [
          { name: "Puxada frente", sets: 4, reps: "8‚Äì10" },
          { name: "Remada curvada", sets: 3, reps: "8‚Äì10" },
          { name: "Remada unilateral", sets: 3, reps: "10‚Äì12" },
          { name: "Rosca direta", sets: 3, reps: "10‚Äì12" },
          { name: "Rosca martelo", sets: 3, reps: "10‚Äì12" }
        ],
        "Legs": [
          { name: "Agachamento livre / hack", sets: 4, reps: "8‚Äì10" },
          { name: "Leg press", sets: 4, reps: "10‚Äì12" },
          { name: "Cadeira abdutora", sets: 3, reps: "12‚Äì15" },
          { name: "Levantamento terra romeno", sets: 3, reps: "8‚Äì10" }
        ],
        "Cardio leve": [
          { name: "Caminhada r√°pida", sets: 1, reps: "20‚Äì30 min" },
          { name: "Bike ergom√©trica", sets: 1, reps: "10‚Äì15 min" }
        ],
        "HIIT leve": [
          { name: "Bike ‚Äì 30s forte / 90s leve", sets: 8, reps: "intervalos" },
          { name: "Caminhada com inclina√ß√£o", sets: 1, reps: "15‚Äì20 min" }
        ],
        "Core & mobilidade": [
          { name: "Prancha frontal", sets: 3, reps: "30‚Äì40s" },
          { name: "Prancha lateral", sets: 3, reps: "20‚Äì30s" },
          { name: "Alongamentos gerais", sets: 1, reps: "10‚Äì15 min" }
        ]
      };

      const plan = {};

      if (goal === "perda") {
        if (f === 3) {
          plan["Segunda"] = base["Full body leve"];
          plan["Quarta"] = base["Full body leve"];
          plan["Sexta"] = [...base["Full body leve"], ...base["Cardio leve"]];
        } else if (f === 4) {
          plan["Segunda"] = base["Upper"];
          plan["Ter√ßa"] = [...base["Cardio leve"]];
          plan["Quinta"] = base["Lower"];
          plan["S√°bado"] = [...base["Cardio leve"], ...base["Core & mobilidade"]];
        } else if (f === 5) {
          plan["Segunda"] = base["Upper"];
          plan["Ter√ßa"] = base["Lower"];
          plan["Quarta"] = base["Cardio leve"];
          plan["Quinta"] = base["Upper"];
          plan["Sexta"] = [...base["Lower"], ...base["Core & mobilidade"]];
        } else if (f === 6) {
          plan["Segunda"] = base["Upper"];
          plan["Ter√ßa"] = base["Lower"];
          plan["Quarta"] = base["HIIT leve"];
          plan["Quinta"] = base["Upper"];
          plan["Sexta"] = base["Lower"];
          plan["S√°bado"] = [...base["Cardio leve"], ...base["Core & mobilidade"]];
        }
      } else if (goal === "manutencao") {
        if (f === 3) {
          plan["Segunda"] = base["Full body leve"];
          plan["Quarta"] = [...base["Full body leve"], ...base["Core & mobilidade"]];
          plan["Sexta"] = base["Cardio leve"];
        } else if (f === 4) {
          plan["Segunda"] = base["Upper"];
          plan["Quarta"] = base["Lower"];
          plan["Sexta"] = base["Cardio leve"];
          plan["S√°bado"] = base["Core & mobilidade"];
        } else if (f >= 5) {
          plan["Segunda"] = base["Upper"];
          plan["Ter√ßa"] = base["Lower"];
          plan["Quarta"] = base["Cardio leve"];
          plan["Quinta"] = base["Upper"];
          plan["S√°bado"] = base["Core & mobilidade"];
        }
      } else if (goal === "hipertrofia") {
        if (f === 3) {
          plan["Segunda"] = base["Push"];
          plan["Quarta"] = base["Pull"];
          plan["Sexta"] = base["Legs"];
        } else if (f === 4) {
          plan["Segunda"] = base["Push"];
          plan["Ter√ßa"] = base["Pull"];
          plan["Quinta"] = base["Legs"];
          plan["S√°bado"] = base["Core & mobilidade"];
        } else if (f === 5) {
          plan["Segunda"] = base["Push"];
          plan["Ter√ßa"] = base["Pull"];
          plan["Quarta"] = base["Legs"];
          plan["Sexta"] = base["Push"];
          plan["S√°bado"] = base["Pull"];
        } else if (f === 6) {
          plan["Segunda"] = base["Push"];
          plan["Ter√ßa"] = base["Pull"];
          plan["Quarta"] = base["Legs"];
          plan["Quinta"] = base["Push"];
          plan["Sexta"] = base["Pull"];
          plan["S√°bado"] = base["Legs"];
        }
      }
      return plan;
    }

    // Progresso de treino: salva em localStorage por usu√°rio+semana
    function getTrainingStorageKey() {
      if (!currentUser) return null;
      const now = new Date();
      const year = now.getFullYear();
      // semana "gambiarra" simples: ano + n√∫mero da semana aproximado
      const startOfYear = new Date(year, 0, 1);
      const days = Math.floor((now - startOfYear) / (1000 * 60 * 60 * 24));
      const approxWeek = Math.floor(days / 7) + 1;
      return `darkPremium_training_${currentUser.uid}_${year}_W${approxWeek}`;
    }

    function loadTrainingDone() {
      const key = getTrainingStorageKey();
      if (!key) return {};
      const raw = localStorage.getItem(key);
      if (!raw) return {};
      try {
        return JSON.parse(raw);
      } catch {
        return {};
      }
    }

    function saveTrainingDone(doneObj) {
      const key = getTrainingStorageKey();
      if (!key) return;
      localStorage.setItem(key, JSON.stringify(doneObj));
    }

    function updateTrainingSection() {
      const goal = profileData.goalType || "";
      const freq = profileData.trainingFreq || "";
      const template = getTrainingTemplate(goal, freq);
      trainingPlanDiv.innerHTML = "";
      trainingSummaryRow.innerHTML = "";

      if (!goal || !freq || Object.keys(template).length === 0) {
        trainingText.textContent = "Defina objetivo e treinos/semana no perfil para ver um plano di√°rio bonitinho.";
        trainingFreqLabel.textContent = "0 / 0";
        trainingBarFill.style.width = "0%";
        kpiFreq.textContent = "0 / 0";
        kpiFreqHelper.textContent = "Sem plano definido.";
        return;
      }

      // Resuminho do plano
      const goalLabel = {
        perda: "Perda de gordura",
        manutencao: "Sa√∫de / Manuten√ß√£o",
        hipertrofia: "Hipertrofia"
      }[goal] || "-";

      const pillGoal = document.createElement("span");
      pillGoal.className = "pill-tag";
      pillGoal.textContent = "Objetivo: " + goalLabel;
      const pillFreq = document.createElement("span");
      pillFreq.className = "pill-tag";
      pillFreq.textContent = "Treinos/semana: " + freq;
      trainingSummaryRow.appendChild(pillGoal);
      trainingSummaryRow.appendChild(pillFreq);

      const doneObj = loadTrainingDone();

      let totalExercises = 0;
      let doneExercises = 0;

      for (const day of daysOfWeek) {
        const list = template[day];
        if (!list || list.length === 0) continue;

        const dayDiv = document.createElement("div");
        dayDiv.className = "exercise-day";

        const header = document.createElement("div");
        header.className = "exercise-day-header";
        header.textContent = day;
        dayDiv.appendChild(header);

        list.forEach((ex, idx) => {
          totalExercises++;
          const id = `${day}_${idx}_${ex.name}`;
          const line = document.createElement("div");
          line.className = "exercise-item";

          const check = document.createElement("input");
          check.type = "checkbox";
          check.checked = !!doneObj[id];
          if (check.checked) doneExercises++;

          check.addEventListener("change", () => {
            const updated = loadTrainingDone();
            if (check.checked) {
              updated[id] = true;
            } else {
              delete updated[id];
            }
            saveTrainingDone(updated);
            updateTrainingSection(); // recalc barra & kpi
          });

          const label = document.createElement("label");
          label.style.marginBottom = "0";
          label.innerHTML = `<strong>${ex.name}</strong> ‚Äì ${ex.sets}x ${ex.reps}`;

          line.appendChild(check);
          line.appendChild(label);
          dayDiv.appendChild(line);
        });

        trainingPlanDiv.appendChild(dayDiv);
      }

      // C√°lculo da frequ√™ncia
      const percent = totalExercises === 0 ? 0 : Math.round((doneExercises / totalExercises) * 100);
      trainingBarFill.style.width = percent + "%";
      trainingFreqLabel.textContent = `${doneExercises} / ${totalExercises}`;
      kpiFreq.textContent = `${doneExercises} / ${totalExercises}`;

      let freqMsg = "";
      if (totalExercises === 0) {
        freqMsg = "Plano vazio ou frequ√™ncia incoerente. Ajuste no perfil.";
      } else if (percent === 0) {
        freqMsg = "Barra zerada. A boa not√≠cia √© que qualquer treino agora j√° melhora esse gr√°fico üòÖ";
      } else if (percent < 40) {
        freqMsg = `${percent}% dos exerc√≠cios foram feitos. O plano existe, mas voc√™ t√° tratando como sugest√£o de amigo, n√£o como compromisso.`;
      } else if (percent < 70) {
        freqMsg = `${percent}% conclu√≠do. Nada mal! Com mais uns treinos, essa barra fica bonita.`;
      } else if (percent < 100) {
        freqMsg = `${percent}%! Seu sof√° est√° oficialmente com ci√∫mes.`;
      } else {
        freqMsg = `100% dos exerc√≠cios da semana conclu√≠dos. Agora sim: culpa liberada para um docinho estrat√©gico.`;
      }
      trainingText.textContent = freqMsg;
      kpiFreqHelper.textContent = percent === 0 ? "Semana em branco." : "Semana com treinos registrados.";
    }

    // === DIETAS ===
    function renderDietInfo() {
      const type = profileData.dietType || "";
      if (!type) {
        dietInfoDiv.innerHTML = `<p class="small">Selecione uma dieta no campo <strong>Dieta</strong> do perfil para ver recomenda√ß√µes.</p>`;
        return;
      }

      const diets = {
        lowcarb: {
          name: "Low carb",
          focus: "Reduzir carboidratos refinados, priorizar prote√≠nas e gorduras boas.",
          recommended: [
            "Carnes magras, ovos, frango, peixe",
            "Verduras e legumes variados",
            "Abacate, azeite de oliva, oleaginosas (castanhas, nozes)",
            "Queijos e iogurte natural (sem a√ß√∫car)",
            "√Ågua, ch√°s sem a√ß√∫car, caf√© sem a√ß√∫car"
          ],
          avoid: [
            "A√ß√∫car, doces, refrigerantes",
            "P√£es, massas, bolos, biscoitos",
            "Arroz branco em excesso",
            "Sucos industrializados e naturais em excesso",
            "Batata frita, salgados, ultra processados"
          ],
          menu: [
            "Caf√© da manh√£: Omelete com queijo e espinafre + caf√© sem a√ß√∫car.",
            "Almo√ßo: Frango grelhado + salada verde grande + azeite.",
            "Lanche: Castanhas + 1 iogurte natural.",
            "Jantar: Peixe assado + legumes refogados.",
            "Ceia (se necess√°rio): Ch√° sem a√ß√∫car + 1 peda√ßo pequeno de queijo."
          ]
        },
        hiperproteica: {
          name: "Hiperproteica / Hipertrofia",
          focus: "Maximizar prote√≠na para construir massa magra, com carboidrato bem posicionado.",
          recommended: [
            "Carnes magras, frango, peixe, ovos, whey protein",
            "Arroz integral, batata doce, mandioca em por√ß√µes controladas",
            "Feij√£o, lentilha, gr√£o-de-bico",
            "Frutas (banana, ma√ß√£, frutas vermelhas)",
            "√Ågua em boa quantidade, eletr√≥litos se necess√°rio"
          ],
          avoid: [
            "Muito a√ß√∫car simples antes de dormir",
            "Refrigerantes, √°lcool em excesso",
            "Fast food frequente",
            "‚ÄúBulking sujo‚Äù (comer qualquer coisa s√≥ para bater calorias)"
          ],
          menu: [
            "Caf√© da manh√£: Whey + aveia + banana.",
            "Lanche manh√£: Frutas + castanhas.",
            "Almo√ßo: Arroz + feij√£o + carne magra + salada.",
            "Pr√©-treino: Banana + caf√© ou ch√°.",
            "P√≥s-treino: Whey + fonte de carbo (banana ou tapioca).",
            "Jantar: Carne ou frango + legumes + pequena por√ß√£o de carboidrato.",
            "Ceia: Iogurte + case√≠na ou queijo branco."
          ]
        },
        mediterranea: {
          name: "Mediterr√¢nea",
          focus: "Estilo de vida: comida de verdade, azeite, peixes, gr√£os e vegetais.",
          recommended: [
            "Peixes, frutos do mar, frango, ovos",
            "Azeite de oliva, oleaginosas",
            "Gr√£os integrais (arroz integral, quinoa, aveia)",
            "Frutas e vegetais variados",
            "Iogurte e queijos em modera√ß√£o"
          ],
          avoid: [
            "Ultra processados e fast food frequente",
            "A√ß√∫car refinado em excesso",
            "Gorduras trans",
            "Refrigerantes e bebidas a√ßucaradas"
          ],
          menu: [
            "Caf√© da manh√£: Iogurte natural + frutas + aveia + mel.",
            "Almo√ßo: Peixe grelhado + salada colorida + azeite + arroz integral.",
            "Lanche: Mix de castanhas + 1 fruta.",
            "Jantar: Frango assado + legumes + batata.",
            "Extra: 1 ta√ßa de vinho tinto ocasional (se liberado pelo m√©dico)."
          ]
        }
      };

      const d = diets[type];
      if (!d) {
        dietInfoDiv.innerHTML = `<p class="small">Dieta n√£o reconhecida. Selecione outra op√ß√£o.</p>`;
        return;
      }

      dietInfoDiv.innerHTML = `
        <p class="small"><strong>${d.name}</strong> ‚Äì ${d.focus}</p>
        <div class="grid-2" style="margin-top:6px;">
          <div>
            <h3 style="font-size:0.9rem;margin-bottom:4px;">Alimentos recomendados</h3>
            <ul class="small">
              ${d.recommended.map((item) => `<li>${item}</li>`).join("")}
            </ul>
          </div>
          <div>
            <h3 style="font-size:0.9rem;margin-bottom:4px;">Evitar / limitar</h3>
            <ul class="small">
              ${d.avoid.map((item) => `<li>${item}</li>`).join("")}
            </ul>
          </div>
        </div>
        <h3 style="font-size:0.9rem;margin-top:8px;margin-bottom:4px;">Sugest√£o de card√°pio di√°rio</h3>
        <ul class="small">
          ${d.menu.map((item) => `<li>${item}</li>`).join("")}
        </ul>
      `;
    }

    // === SUPLEMENTOS ===
    function renderSupplements() {
      const txt = (profileData.supplementsUser || "").toLowerCase();
      if (!txt) {
        supplementsSuggestions.innerHTML = `<p class="small">Adicione suplementos no campo do perfil (ex: <strong>whey, creatina, multivitam√≠nico</strong>) para ver sugest√µes.</p>`;
        return;
      }

      const rules = [
        {
          key: "whey",
          title: "Whey protein",
          tips: [
            "P√≥s-treino: 1 dose logo ap√≥s o treino, junto de √°gua ou leite.",
            "Pode usar como complemento de prote√≠na em refei√ß√µes com pouca prote√≠na.",
            "N√£o √© obrigat√≥rio: se bater prote√≠na na comida, j√° ajuda muito."
          ]
        },
        {
          key: "creatina",
          title: "Creatina",
          tips: [
            "3 a 5 g por dia, todos os dias (inclusive descanso).",
            "Pode tomar em qualquer hor√°rio, junto com alguma refei√ß√£o.",
            "Beber √°gua ao longo do dia ajuda no uso adequado."
          ]
        },
        {
          key: "omega",
          title: "√îmega 3",
          tips: [
            "Tomar junto de refei√ß√£o com gordura (ex: almo√ßo ou jantar).",
            "Ajuda em sa√∫de cardiovascular e controle de inflama√ß√£o.",
            "Dose conforme orienta√ß√£o do r√≥tulo ou do m√©dico."
          ]
        },
        {
          key: "vitamina d",
          title: "Vitamina D",
          tips: [
            "Tomar 1x ao dia com refei√ß√£o que tenha gordura (ex: almo√ßo ou jantar).",
            "Monitorar dose com exames e orienta√ß√£o m√©dica.",
            "N√£o exagerar por conta pr√≥pria ‚Äì n√£o √© bala juquinha."
          ]
        },
        {
          key: "multivit",
          title: "Multivitam√≠nico",
          tips: [
            "Tomar pela manh√£ ou almo√ßo, junto com refei√ß√£o.",
            "Evitar tomar em jejum se te der enjoo.",
            "Usar como complemento, n√£o como desculpa pra comer mal."
          ]
        }
      ];

      const items = rules.filter((r) => txt.includes(r.key));
      if (items.length === 0) {
        supplementsSuggestions.innerHTML = `<p class="small">N√£o encontrei nenhum suplemento reconhecido. Tente termos como: <strong>whey, creatina, omega 3, vitamina D, multivitam√≠nico</strong>.</p>`;
        return;
      }

      supplementsSuggestions.innerHTML = items
        .map(
          (s) => `
          <div style="margin-bottom:8px;">
            <h3 style="font-size:0.9rem;margin-bottom:4px;">${s.title}</h3>
            <ul class="small">
              ${s.tips.map((t) => `<li>${t}</li>`).join("")}
            </ul>
          </div>
        `
        )
        .join("");
    }

    // Atualizar dietas e suplementos quando selects mudam (mesmo antes de salvar, s√≥ pra visual)
    dietType.addEventListener("change", () => {
      profileData.dietType = dietType.value;
      renderDietInfo();
    });
    supplementsUser.addEventListener("change", () => {
      profileData.supplementsUser = supplementsUser.value;
      renderSupplements();
    });

  </script>
</body>
</html>
